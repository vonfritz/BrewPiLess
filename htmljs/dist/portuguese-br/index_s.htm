<!DOCTYPE html><html lang="pt-br"><head><meta http-equiv=content-type content="text/html; charset=utf-8"><meta name=viewport content="width=device-width,initial-scale=1"><title> BrewPiLess em serviço! </title><meta name=apple-mobile-web-app-title content=BrewPiLess><meta name=apple-mobile-web-app-capable content=yes><script type=text/javascript src=/dygraph.min.js ignore></script><script>!function(){"use strict";var n;window.Dygraph?n=window.Dygraph:"undefined"!=typeof module&&(n=require("../dygraph"));function a(n,a){if(!Array.isArray(n)||!Array.isArray(a))return!1;var t=n.length;if(t!==a.length)return!1;for(;t--;)if(n[t]!==a[t])return!1;return!0}function t(n,t,e){for(var i=!1,r=0;r<n.length;r++){n[r].updateOptions({drawCallback:function(r,l){if(!i&&!l){i=!0;var o={dateWindow:r.xAxisRange()};t.range&&(o.valueRange=r.yAxisRange());for(var h=0;h<n.length;h++)n[h]!=r?a(o.dateWindow,n[h].getOption("dateWindow"))&&a(o.valueRange,n[h].getOption("valueRange"))||n[h].updateOptions(o):e[h]&&e[h].drawCallback&&e[h].drawCallback.apply(this,arguments);i=!1}}},!0)}}function e(n,a){for(var t=!1,e=0;e<n.length;e++){n[e].updateOptions({highlightCallback:function(e,i,r,l,o){if(!t){t=!0;for(var h=0;h<n.length;h++)if(this!=n[h]){var g=n[h].getRowForX(i);null!==g&&n[h].setSelection(g,o)}else a[h]&&a[h].highlightCallback&&a[h].highlightCallback.apply(this,arguments);t=!1}},unhighlightCallback:function(e){if(!t){t=!0;for(var i=0;i<n.length;i++)this!=n[i]?n[i].clearSelection():a[i]&&a[i].unhighlightCallback&&a[i].unhighlightCallback.apply(this,arguments);t=!1}}},!0)}}n.synchronize=function(){if(0===arguments.length)throw"Invalid invocation of Dygraph.synchronize(). Need >= 1 argument.";var a=["selection","zoom","range"],i={selection:!0,zoom:!0,range:!0},r=[],l=[],o=function(n){if(!(n instanceof Object))throw"Last argument must be either Dygraph or Object.";for(var t=0;t<a.length;t++){var e=a[t];n.hasOwnProperty(e)&&(i[e]=n[e])}};if(arguments[0]instanceof n){for(var h=0;h<arguments.length&&arguments[h]instanceof n;h++)r.push(arguments[h]);if(h<arguments.length-1)throw"Invalid invocation of Dygraph.synchronize(). All but the last argument must be Dygraph objects.";h==arguments.length-1&&o(arguments[arguments.length-1])}else{if(!arguments[0].length)throw"Invalid invocation of Dygraph.synchronize(). First parameter must be either Dygraph or list of Dygraphs.";for(h=0;h<arguments[0].length;h++)r.push(arguments[0][h]);if(2==arguments.length)o(arguments[1]);else if(arguments.length>2)throw"Invalid invocation of Dygraph.synchronize(). Expected two arguments: array and optional options argument."}if(r.length<2)throw"Invalid invocation of Dygraph.synchronize(). Need two or more dygraphs to synchronize.";var g=r.length;for(h=0;h<r.length;h++)r[h].ready(function(){if(0==--g){for(var n=["drawCallback","highlightCallback","unhighlightCallback"],a=0;a<r.length;a++){l[a]||(l[a]={});for(var o=n.length-1;o>=0;o--)l[a][n[o]]=r[a].getFunctionOption(n[o])}i.zoom&&t(r,i,l),i.selection&&e(r,l)}});return{detach:function(){for(var n=0;n<r.length;n++){var a=r[n];i.zoom&&a.updateOptions({drawCallback:l[n].drawCallback}),i.selection&&a.updateOptions({highlightCallback:l[n].highlightCallback,unhighlightCallback:l[n].unhighlightCallback})}r=null,i=null,l=null}}}}()</script><script>function invoke(n){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?n.success(e.responseText):e.onerror(e.status))},e.ontimeout=function(){void 0!==n.timeout?n.timeout():e.onerror(-1)},e.onerror=function(e){void 0!==n.fail&&n.fail(e)},e.open(n.m,n.url,!0),void 0!==n.data?(e.setRequestHeader("Content-Type",void 0!==n.mime?n.mime:"application/x-www-form-urlencoded"),e.send(n.data)):e.send()}var BWF={BrewProfile:"/brewing.json",process:function(msg){if(null==this.raw)for(var key in eval("m={"+msg+"}"),m)void 0!==this.handlers[key]&&this.handlers[key](m[key]);else this.raw(msg)},on:function(n,e){this.handlers[n]=e},send:function(n){1==this.ws.readyState&&this.ws.send(n)},reconnecting:!1,connect:function(){var n=this;if("undefined"!=typeof WebSocket){var e=new WebSocket("ws://"+document.location.host+"/ws");n.ws=e,e.onopen=function(){console.log("Connected"),n.onconnect()},e.onclose=function(){n.reconnecting||(console.log("WS close"),n.error(-2),n.auto&&setTimeout(function(){n.reconnect()},5e3))},e.onmessage=function(e){n.process(e.data)}}else alert("Error! WebSocket Not Supported!")},reconnect:function(n){n=void 0!==n;var e=this;e.reconnecting||(n||1!=e.ws.readyState)&&(console.log("reconnect forced:"+n+" state:"+e.ws.readyState),e.reconnecting=!0,e.ws.close(),e.connect(),e.reconnecting=!1)},init:function(n){var e=this;e.error=void 0===n.error?function(){}:n.error,e.handlers=void 0===n.handlers?{}:n.handlers,e.raw=void 0===n.raw?null:n.raw,e.onconnect=void 0===n.onconnect?function(){}:n.onconnect,e.auto=void 0===n.reconnect||n.reconnect,e.connect()},save:function(n,e,o,t){invoke({m:"POST",url:"/fputs",data:"path="+n+"&content="+encodeURIComponent(e),success:function(){o()},fail:function(n){t(n)}})},load:function(n,e,o){invoke({m:"GET",url:n,success:function(n){e(n)},fail:function(n){o(n)}})}}</script><script>var CHART_VERSION=6,GravityFilter={b:.1,y:0,reset:function(){this.y=0},add:function(e){return 0==this.y?this.y=e:this.y=this.y+this.b*(e-this.y),Math.round(1e4*this.y)/1e4},setBeta:function(e){this.b=e}},GravityTracker={NumberOfSlots:48,InvalidValue:255,ridx:0,record:[],threshold:1,setThreshold:function(e){this.threshold=e},addRecord:function(e){this.record[this.ridx++]=e,this.ridx>=this.NumberOfSlots&&(this.ridx=0)},stable:function(e,t){t=void 0===t?this.threshold:t;var a=this.ridx-1;a<0&&(a=this.NumberOfSlots-1);for(var r=this.NumberOfSlots+this.ridx-e;r>=this.NumberOfSlots;)r-=this.NumberOfSlots;return this.record[r]-this.record[a]<=t},Period:3600,init:function(){this.curerntStart=0,this.lastValue=0},add:function(e,t){var a=t-this.curerntStart;if(a>this.Period){if(this.addRecord(e),0!=this.lastValue)for(a-=this.Period;a>this.Period;)a-=this.Period,this.addRecord(this.lastValue);this.curerntStart=t,this.lastValue=e}}};function fgstate(e){Q("#fgstate").style.backgroundColor={0:"red",12:"orange",24:"yellow",48:"green"}[e]}function checkfgstate(){GravityTracker.stable(12)?GravityTracker.stable(24)?GravityTracker.stable(48)?fgstate(48):fgstate(24):fgstate(12):fgstate(0)}var GravityAndTiltIndex=6,PSIIndex=7,RoomTemperatureIndex=4,BrewChart=function(e){var t=this;t.cid=e,t.ctime=0,t.interval=60,t.numLine=7,t.numData=8,t.calculateSG=!1,t.calibrating=!1,t.lidx=0,t.celius=!0,t.clearData()},colorIdle="white",colorCool="rgba(0, 0, 255, 0.4)",colorHeat="rgba(255, 0, 0, 0.4)",colorWaitingHeat="rgba(255, 0, 0, 0.2)",colorWaitingCool="rgba(0, 0, 255, 0.2)",colorHeatingMinTime="rgba(255, 0, 0, 0.6)",colorCoolingMinTime="rgba(0, 0, 255, 0.6)",colorWaitingPeakDetect="rgba(0, 0, 0, 0.2)",colorPressure="#0000EE",STATE_LINE_WIDTH=15,STATES=[{name:"IDLE",color:colorIdle,text:"Inativo"},{name:"STATE_OFF",color:colorIdle,text:"Desligado"},{name:"DOOR_OPEN",color:"#eee",text:"Porta Aberta",doorOpen:!0},{name:"HEATING",color:colorHeat,text:"Aquecendo"},{name:"COOLING",color:colorCool,text:"Esfriando"},{name:"WAITING_TO_COOL",color:colorWaitingCool,text:"Aguardando para Esfriar",waiting:!0},{name:"WAITING_TO_HEAT",color:colorWaitingHeat,text:"Aguardando para Aquecer",waiting:!0},{name:"WAITING_FOR_PEAK_DETECT",color:colorWaitingPeakDetect,text:"Aguardando Pico",waiting:!0},{name:"COOLING_MIN_TIME",color:colorCoolingMinTime,text:"Tempo Min. Esfriando",extending:!0},{name:"HEATING_MIN_TIME",color:colorHeatingMinTime,text:"Tempo Min. Aquecendo",extending:!0},{name:"INVALID",color:colorHeatingMinTime,text:"Status Inválido"}];BrewChart.Mode={b:"Beer Constant",f:"Fridge Constant",o:"Off",p:"Profile"},BrewChart.Colors=["rgb(240, 100, 100)","rgb(41,170,41)","rgb(89, 184, 255)","rgb(255, 161, 76)","#AAAAAA","#f5e127","rgb(153,0,153)","#000abb",colorPressure],BrewChart.Labels=["Time","beerSet","beerTemp","fridgeTemp","fridgeSet","roomTemp","auxTemp","gravity","filtersg"],BrewChart.ClassLabels=["","beer-set","beer-temp","fridge-temp","fridge-set","room-temp","aux-temp","gravity","filtersg"];var BeerTempLine=2,BeerSetLine=1,FridgeTempLine=3,FridgeSetLine=4,RoomTempLine=5,AuxTempLine=6,GravityLineIndex=7,FilteredSgLine=8,PressureLine=9,PressureSetLine=10,CarbonationLine=11,PSIDataIndex=8;BrewChart.prototype.clearData=function(){this.laststat=[NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN],this.sg=NaN,this.og=NaN},BrewChart.prototype.setCelius=function(e){this.celius=e,this.ylabel(STR.ChartLabel+"("+(e?"°C":"°F")+")")},BrewChart.prototype.incTime=function(){this.ctime+=this.interval},BrewChart.prototype.formatDate=function(e){var t=e.getHours(),a=e.getMinutes(),r=e.getSeconds();function i(e){return e>9?e:"0"+e}return e.toLocaleDateString()+" "+i(t)+":"+i(a)+":"+i(r)},BrewChart.prototype.formatDuration=function(e){var t="",a=Math.floor(e/86400);return a>0&&(t=a+"d",e-=86400*a),t=t+(e/3600).toFixed(1)+"h"},BrewChart.prototype.showLegend=function(e,t){var a=new Date(e);Q(".beer-chart-legend-time").innerHTML=this.formatDate(a),Q(".beer-chart-legend-elapse")&&(Q(".beer-chart-legend-elapse").innerHTML=this.formatDuration(a.getTime()/1e3-this.starttime)),Q(".chart-legend-row.beer-temp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,BeerTempLine)),Q(".chart-legend-row.beer-set .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,BeerSetLine)),Q(".chart-legend-row.fridge-temp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,FridgeTempLine)),Q(".chart-legend-row.fridge-set .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,FridgeSetLine)),Q(".chart-legend-row.room-temp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,RoomTempLine)),Q(".chart-legend-row.aux-temp .legend-value").innerHTML=this.tempFormat(this.chart.getValue(t,AuxTempLine));var r=this.chart.getValue(t,GravityLineIndex);Q(".chart-legend-row.gravity .legend-value").innerHTML=!r||isNaN(r)?"--":this.plato?r.toFixed(2)+"&deg;P":r.toFixed(4);var i=this.chart.getValue(t,FilteredSgLine);Q(".chart-legend-row.filtersg .legend-value").innerHTML=!i||isNaN(i)?"--":this.plato?i.toFixed(2)+"&deg;P":i.toFixed(4);var n=parseInt(this.state[t]);if(isNaN(n)||(Q(".beer-chart-state").innerHTML=STATES[n].text),this.psiAvail){var o=this.pchart.getValue(t,1);Q(".chart-legend-row.pressure .legend-value").innerHTML=null==o||isNaN(o)?"--":o.toFixed(1);var s=this.pchart.getValue(t,2);Q(".chart-legend-row.pressure-set .legend-value").innerHTML=null==s||isNaN(s)?"--":Math.round(s);var l=this.pchart.getValue(t,3);Q(".chart-legend-row.carbonation .legend-value").innerHTML=null==l||isNaN(l)?"--":l.toFixed(1)}},BrewChart.prototype.hideLegend=function(){document.querySelectorAll(".legend-value").forEach(function(e){e.innerHTML="--"}),Q(".beer-chart-legend-time").innerHTML=this.dateLabel,Q(".beer-chart-state").innerHTML="Estado"},BrewChart.prototype.tempFormat=function(e){var t=parseFloat(e);if(isNaN(t))return"--";var a=this.celius?"&deg;C":"&deg;F";return parseFloat(t).toFixed(2)+a},BrewChart.prototype.initLegend=function(){if(Q(".beer-temp .toggle"))for(var e=1;e<BrewChart.ClassLabels.length;e++){var t=BrewChart.ClassLabels[e];Q(".chart-legend-row."+t).style.color=BrewChart.Colors[e-1],Q("."+t+".toggle").style.backgroundColor=BrewChart.Colors[e-1]}this.dateLabel=Q(".beer-chart-legend-time").innerHTML},BrewChart.prototype.togglePsiLine=function(e){var t=this;t.psiAvail&&(t.showPsi=!t.showPsi,t.showPsi?this.pchart.setVisibility(e-PressureLine,!0):this.pchart.setVisibility(e-PressureLine,!1))},BrewChart.prototype.toggleLine=function(e){var t=this;t.shownlist[e]=!t.shownlist[e];var a=BrewChart.ClassLabels[e];t.shownlist[e]?(Q("."+a+" .toggle")&&(Q("."+a+" .toggle").style.backgroundColor=Q(".chart-legend-row."+a).style.color),t.chart.setVisibility(e-1,!0)):(Q("."+a+" .toggle")&&(Q("."+a+" .toggle").style.backgroundColor="transparent"),t.chart.setVisibility(e-1,!1))},BrewChart.prototype.setLabels=function(e,t){this.ylabel=e,this.y2label=t},BrewChart.prototype.setPChart=function(e,t,a){this.pcid=e,this.plabel=t,this.clabel=a},BrewChart.prototype.createPSIChart=function(){var e=this,t=document.createElement("div");t.className="hide",document.body.appendChild(t);var a={labels:["Time","psi","psiset","co2"],colors:[colorPressure,"rgb(240, 100, 100)","gray"],connectSeparatedPoints:!0,ylabel:e.plabel,y2label:e.clabel,series:{co2:{axis:"y2",drawPoints:!1}},axisLabelFontSize:12,gridLineColor:"#ccc",gridLineWidth:"0.1px",labelsDiv:t,labelsDivStyles:{display:"none"},strokeWidth:1,axes:{y:{valueFormatter:function(e){return e.toFixed(1)},axisLabelFormatter:function(e){return e.toFixed(1)}},y2:{valueFormatter:function(e){return e.toFixed(1)},axisLabelFormatter:function(e){return e.toFixed(1)}}},highlightCallback:function(t,a,r,i){e.showLegend(a,i)},unhighlightCallback:function(t){e.hideLegend()}};e.pchart=new Dygraph(document.getElementById(e.pcid),e.psi,a),e.pchart.setVisibility(0,!0)},BrewChart.prototype.createChart=function(){var e=this;e.initLegend(),e.shownlist=[!0,!0,!0,!0,!0,!0,!0,!0,!0],e.showPsi=!0;var t=document.createElement("div");t.className="hide";var a=(e.ylabel?e.ylabel:"Temperature")+"(&deg;"+(e.celius?"C":"F")+")",r=e.y2label?e.y2label:"Gravity";document.body.appendChild(t);var i={labels:BrewChart.Labels,colors:BrewChart.Colors,connectSeparatedPoints:!0,ylabel:a,y2label:r,series:{gravity:{axis:"y2",drawPoints:!0,pointSize:2,highlightCircleSize:4},filtersg:{axis:"y2"}},axisLabelFontSize:12,animatedZooms:!0,gridLineColor:"#ccc",gridLineWidth:"0.1px",labelsDiv:t,labelsDivStyles:{display:"none"},displayAnnotations:!0,strokeWidth:1,axes:{y:{valueFormatter:function(t){return e.tempFormat(t)}},y2:{valueFormatter:function(t){return e.plato?t.toFixed(1):t.toFixed(3)},axisLabelFormatter:function(t){var a=this.yAxisRange(1);return e.plato?a[1]-a[0]>1?t.toFixed(1):t.toFixed(2):a[1]-a[0]>.002?t.toFixed(3).substring(1):t.toFixed(4).substring(2)}}},highlightCircleSize:2,highlightSeriesOpts:{strokeWidth:1.5,strokeBorderWidth:1,highlightCircleSize:5},highlightCallback:function(t,a,r,i){e.showLegend(a,i)},unhighlightCallback:function(t){e.hideLegend()},underlayCallback:function(t,a,r){t.save();try{e.drawBackground(t,a,r)}finally{t.restore()}}};e.chart=new Dygraph(document.getElementById(e.cid),e.data,i)},BrewChart.prototype.findNearestRow=function(e,t){"use strict";for(var a,r,i=0,n=e.numRows()-1;i<n;)if(a=Math.floor((i+n)/2),(r=e.getValue(a,0)-t)<0)i=a+1;else{if(!(r>0))return a;n=a-1}return i},BrewChart.prototype.findStateBlocks=function(e,t,a){"use strict";for(var r,i=[],n=this.state[t],o=t;o<a;o++)(r=this.state[o])!==n&&(i.push({row:o,state:n}),n=r);return i.push({row:a,state:n}),i},BrewChart.prototype.getTime=function(e,t){"use strict";return t>=e.numRows()&&(t=e.numRows()-1),e.getValue(t,0)},BrewChart.prototype.drawBackground=function(e,t,a){var r=a.toDataXCoord(t.x),i=a.toDataXCoord(t.x+t.w),n=Math.max(this.findNearestRow(a,r)-1,0),o=this.findNearestRow(a,i)+1;if(null!==n&&null!==o)for(var s=this.findStateBlocks(a,n,o),l=0,h=0;h<s.length;h++){var c=s[h],d=c.row,u=(this.getTime(a,d)-r)/(i-r),g=Math.floor(t.x+t.w*u),p=STATES[parseInt(c.state,10)];void 0===p&&(p=STATES[0]),e.fillStyle=p.color,e.fillRect(l,t.h-STATE_LINE_WIDTH,g-l,t.h),l=g}},BrewChart.prototype.addMode=function(e,t){var a=String.fromCharCode(e);this.anno.push({series:"beerTemp",x:t,shortText:a.toUpperCase(),text:BrewChart.Mode[a],attachAtBottom:!0})},BrewChart.testData=function(e){if(255!=e[0])return!1;var t=7&e[1];return t==CHART_VERSION&&{sensor:t,f:16&e[1]}},BrewChart.prototype.addResume=function(e){this.anno.push({series:"beerTemp",x:1e3*this.ctime,shortText:"R",text:"Resume",attachAtBottom:!0})},BrewChart.prototype.getTiltAround=function(e){var t=this,a=-1,r=-1;if(null!=t.angles[e])return[t.angles[e],t.data[e][AuxTempLine]];for(var i=e-1;i>=0;i--)if(null!=t.angles[i]){a=i;break}for(i=e+1;i<t.angles.length>0;i++)if(null!=t.angles[i]){r=i;break}return a<0&&r<0?null:a<0?[t.angles[r],t.data[r][AuxTempLine]]:r<0?[t.angles[a],t.data[a][AuxTempLine]]:[t.angles[a]+(t.angles[r]-t.angles[a])/(r-a)*(e-a),(t.data[a][AuxTempLine]+t.data[r][AuxTempLine])/2]},BrewChart.prototype.getCalibration=function(){for(var e=[],t=0;t<this.data.length;t++)if(this.rawSG[t]){var a=this.getTiltAround(t);if(a){var r,i=this.celius?C2F(a[1]):a[1],n=this.rawSG[t];r=this.plato?BrewMath.sg2pla(BrewMath.tempCorrectionF(BrewMath.pla2sg(n),C2F(this.coTemp),i)):BrewMath.tempCorrectionF(n,C2F(this.coTemp),i),e.push([a[0],r])}}return e.push([this.tiltInWater,this.readingInWater]),e},BrewChart.prototype.filterPoints=function(e,t){for(var a=[],r=0;r<e.length;r++)t&1<<r||a.push(e[r]);return a},BrewChart.prototype.setIgnoredMask=function(e){return this.cal_igmask!=e&&(this.cal_igmask=e,!0)},BrewChart.prototype.getFormula=function(){var e=this.getCalibration();if(!(e.length<2)){var t=this.filterPoints(e,this.cal_igmask);t.length<2&&(t=e,this.cal_igmask=0);var a=regression("polynomial",t,t.length>3?3:t.length>2?2:1,{precision:9});this.calibrationPoints=e,this.calculateSG=!0,this.sgByTilt=t.length>3?function(e){return a.equation[0]+a.equation[1]*e+a.equation[2]*e*e+a.equation[3]*e*e*e}:t.length>2?function(e){return a.equation[0]+a.equation[1]*e+a.equation[2]*e*e}:function(e){return a.equation[0]+a.equation[1]*e},this.coefficients=t.length>3?[a.equation[0],a.equation[1],a.equation[2],a.equation[3]]:t.length>2?[a.equation[0],a.equation[1],a.equation[2],0]:[a.equation[0],a.equation[1],0,0],this.npt=e.length}},BrewChart.prototype.process=function(e){var t=!1,a=!1,r=this;r.filterSg=null;for(var i=0;i<e.length;){var n=e[i++],o=e[i++];if(255==n){if((15&o)!=CHART_VERSION)return void alert("Versão de registro incompatível!");r.celius=!(16&o),r.calibrating=!(32&o),r.plato=!(64&o);var s=e[i++];s=256*s+e[i++],r.interval=s,r.starttime=(e[i]<<24)+(e[i+1]<<16)+(e[i+2]<<8)+e[i+3],r.ctime=r.starttime,i+=4,r.data=[],r.anno=[],r.state=[],r.angles=[],r.rawSG=[],r.psi=[],r.cstate=0,r.coTemp=20,r.cal_igmask=0,r.specificGravity=null,r.targetPsi=NaN,this.clearData(),t=!0,r.psiAvail=!1,GravityFilter.reset(),GravityTracker.init()}else if(243==n)r.coTemp=o;else if(244==n)r.addMode(o,1e3*r.ctime);else if(245==n)r.targetPsi=0==o?NaN:o;else if(241==n)r.cstate=o;else if(246==n)r.ctime=(e[i]<<24)+(e[i+1]<<16)+(e[i+2]<<8)+e[i+3];else if(254==n){r.lidx=0;var l=e[i++],h=e[i++]+(l<<8)+(o<<16);h>2592e3&&(h=1800);var c=r.starttime+h;c>r.ctime&&(r.data.push([new Date(1e3*r.ctime),NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]),r.state.push(null),r.angles.push(null),r.rawSG.push.null,c-r.ctime>r.interval?r.ctime=c:r.ctime+=r.interval),r.addResume(o)}else if(248==n){var d=256*(127&e[i++])+e[i++];r.og=r.plato?d/100:d/1e4}else if(251==n){d=256*(127&e[i++])+e[i++];r.specificGravity=r.plato?d/100:d/1e4}else if(250==n){var u=e[i++],g=e[i++];r.cal_igmask=(o<<14)+(u<<7)+g}else if(249==n){d=256*(127&e[i++])+e[i++];r.tiltInWater=d/100,r.plato?r.readingInWater=0:r.readingInWater=0==o?1:.9+o/1e3}else if(240==n){r.changes=o,r.lidx=0;var p=new Date(1e3*this.ctime);r.dataset=[p],r.processRecord()}else if(n<128){var f=256*n+o;r.lidx==GravityAndTiltIndex?r.calibrating?f=32767==f?NaN:f/100:(f=32767==f?NaN:r.plato?f/100:f>8e3?f/1e4:f/1e3,a=!0):r.lidx==PSIIndex?f=32767==f?null:f/10-100:(f=32767==f?NaN:f/100)>=225&&(f=225-f),r.lidx<r.numData?void 0!==r.dataset?(r.dataset.push(f),r.laststat[r.lidx]=f,r.lidx++,r.processRecord()):console.log("Error: missing tag."):console.log("Error: data overlap?")}}return{nc:t,sg:a}},BrewChart.prototype.getXRange=function(){return void 0===this.chart?[0,0]:this.chart.xAxisRange()},BrewChart.prototype.setXRange=function(e){void 0!==this.chart&&this.chart.updateOptions({dateWindow:e})},BrewChart.prototype.desync=function(){void 0!==this.sync&&this.sync.detach()},BrewChart.prototype.synchronize=function(){this.sync=Dygraph.synchronize([this.chart,this.pchart],{selection:!0,zoom:!0,range:!1})},BrewChart.prototype.updateChart=function(){var e=this;void 0===e.chart?e.createChart():e.chart.updateOptions({file:e.data}),e.chart.setAnnotations(e.anno),e.psiAvail&&(void 0===e.pchart?(document.querySelectorAll(".pressure-group").forEach(function(e){e.style.visibility="visible"}),e.createPSIChart(),e.synchronize()):e.pchart.updateOptions({file:e.psi,dateWindow:[e.psi[0][0],e.psi[e.psi.length-1][0]]}))},BrewChart.prototype.processRecord=function(){for(var e=this;0==(1<<e.lidx&e.changes)&&e.lidx<e.numData;)e.dataset.push(e.lidx>RoomTemperatureIndex&&e.lidx!=PSIDataIndex?null:e.laststat[e.lidx]),e.lidx++;if(e.lidx>=e.numData){var t=e.dataset.slice(0,8),a=NaN,r=e.dataset[GravityLineIndex];if(e.calibrating)if(e.calculateSG||null==e.specificGravity){if(e.calculateSG&&null!=t[GravityLineIndex]){var i=this.celius?C2F(e.dataset[AuxTempLine]):e.dataset[AuxTempLine];a=e.sgByTilt(e.dataset[GravityLineIndex]),e.plato&&(a=BrewMath.sg2pla(BrewMath.tempCorrectionF(BrewMath.pla2sg(a),i,C2F(e.coTemp)))),t[GravityLineIndex]=a}}else a=e.specificGravity;else null!=r&&(a=r);isNaN(a)||(e.sg=a,e.filterSg=GravityFilter.add(a),e.plato?GravityTracker.add(Math.round(10*e.filterSg),e.ctime):GravityTracker.add(Math.round(1e3*e.filterSg),e.ctime)),isNaN(e.sg)?t.push(null):t.push(e.filterSg),isNaN(e.dataset[PSIDataIndex])||null==e.dataset[PSIDataIndex]||(e.psiAvail=!0);var n=null;if(!isNaN(e.dataset[PSIDataIndex])&&null!=e.dataset[PSIDataIndex]&&!isNaN(e.dataset[BeerTempLine])){var o=e.celius?C2F(e.dataset[BeerTempLine]):e.dataset[BeerTempLine];n=(e.dataset[PSIDataIndex]+14.695)*(.01821+.090115*Math.exp((32-o)/43.11))-.003342,n=Math.round(10*n)/10}e.psi.push([e.dataset[0],e.dataset[PSIDataIndex],e.targetPsi,n]),e.data.push(t),e.state.push(e.cstate),e.calibrating&&(e.angles.push(r),e.rawSG.push(e.specificGravity),e.specificGravity=null),e.incTime()}}</script><script>!function(n,r){"function"==typeof define&&define.amd?define("regression",r):"undefined"!=typeof module?module.exports=r():n.regression=r()}(this,function(){"use strict";function n(n,r){var t=n.reduce(function(n,r){return n+r[1]},0)/n.length,o=n.reduce(function(n,r){var o=r[1]-t;return n+o*o},0);return 1-n.reduce(function(n,t,o){var e=r[o],i=t[1]-e[1];return n+i*i},0)/o}function r(n,r){var t=Math.pow(10,r);return Math.round(n*t)/t}var t={linear:function(t,o,e){for(var i,u,a,l=[0,0,0,0,0],p=t.length,f=0;p>f;f++)null!==t[f][1]&&(l[0]+=t[f][0],l[1]+=t[f][1],l[2]+=t[f][0]*t[f][0],l[3]+=t[f][0]*t[f][1],l[4]+=t[f][1]*t[f][1]);return u=(p*l[3]-l[0]*l[1])/(p*l[2]-l[0]*l[0]),a=l[1]/p-u*l[0]/p,{r2:n(t,i=t.map(function(n){var r=n[0];return[r,u*r+a]})),equation:[u,a],points:i,string:"y = "+r(u,e.precision)+"x + "+r(a,e.precision)}},linearthroughorigin:function(t,o,e){for(var i,u,a=[0,0],l=0;l<t.length;l++)null!==t[l][1]&&(a[0]+=t[l][0]*t[l][0],a[1]+=t[l][0]*t[l][1]);return i=a[1]/a[0],{r2:n(t,u=t.map(function(n){var r=n[0];return[r,i*r]})),equation:[i],points:u,string:"y = "+r(i,e.precision)+"x"}},exponential:function(t,o,e){for(var i,u,a,l,p=[0,0,0,0,0,0],f=0;f<t.length;f++)null!==t[f][1]&&(p[0]+=t[f][0],p[1]+=t[f][1],p[2]+=t[f][0]*t[f][0]*t[f][1],p[3]+=t[f][1]*Math.log(t[f][1]),p[4]+=t[f][0]*t[f][1]*Math.log(t[f][1]),p[5]+=t[f][0]*t[f][1]);return i=p[1]*p[2]-p[5]*p[5],u=Math.exp((p[2]*p[3]-p[5]*p[4])/i),a=(p[1]*p[4]-p[5]*p[3])/i,{r2:n(t,l=t.map(function(n){var r=n[0];return[r,u*Math.exp(a*r)]})),equation:[u,a],points:l,string:"y = "+r(u,e.precision)+"e^("+r(a,e.precision)+"x)"}},logarithmic:function(t,o,e){for(var i,u,a,l=[0,0,0,0],p=t.length,f=0;p>f;f++)null!==t[f][1]&&(l[0]+=Math.log(t[f][0]),l[1]+=t[f][1]*Math.log(t[f][0]),l[2]+=t[f][1],l[3]+=Math.pow(Math.log(t[f][0]),2));return u=(p*l[1]-l[2]*l[0])/(p*l[3]-l[0]*l[0]),i=(l[2]-u*l[0])/p,{r2:n(t,a=t.map(function(n){var r=n[0];return[r,i+u*Math.log(r)]})),equation:[i,u],points:a,string:"y = "+r(i,e.precision)+" + "+r(u,e.precision)+" ln(x)"}},power:function(t,o,e){for(var i,u,a,l=[0,0,0,0],p=t.length,f=0;p>f;f++)null!==t[f][1]&&(l[0]+=Math.log(t[f][0]),l[1]+=Math.log(t[f][1])*Math.log(t[f][0]),l[2]+=Math.log(t[f][1]),l[3]+=Math.pow(Math.log(t[f][0]),2));return u=(p*l[1]-l[2]*l[0])/(p*l[3]-l[0]*l[0]),i=Math.exp((l[2]-u*l[0])/p),{r2:n(t,a=t.map(function(n){var r=n[0];return[r,i*Math.pow(r,u)]})),equation:[i,u],points:a,string:"y = "+r(i,e.precision)+"x^"+r(u,e.precision)}},polynomial:function(t,o,e){var i,u,a,l,p,f,s,c,h=[],g=[],M=0,v=0,d=t.length;for(u=void 0===o?3:o+1,a=0;u>a;a++){for(p=0;d>p;p++)null!==t[p][1]&&(M+=Math.pow(t[p][0],a)*t[p][1]);for(h.push(M),M=0,i=[],l=0;u>l;l++){for(p=0;d>p;p++)null!==t[p][1]&&(v+=Math.pow(t[p][0],a+l));i.push(v),v=0}g.push(i)}for(g.push(h),s=function(n,r){var t=0,o=0,e=0,i=0,u=0,a=n.length-1,l=new Array(r);for(t=0;a>t;t++){for(i=t,o=t+1;a>o;o++)Math.abs(n[t][o])>Math.abs(n[t][i])&&(i=o);for(e=t;a+1>e;e++)u=n[e][t],n[e][t]=n[e][i],n[e][i]=u;for(o=t+1;a>o;o++)for(e=a;e>=t;e--)n[e][o]-=n[e][t]*n[t][o]/n[t][t]}for(o=a-1;o>=0;o--){for(u=0,e=o+1;a>e;e++)u+=n[e][o]*l[e];l[o]=(n[a][o]-u)/n[o][o]}return l}(g,u),f=t.map(function(n){var r=n[0],t=s.reduce(function(n,t,o){return n+t*Math.pow(r,o)},0);return[r,t]}),c="y = ",a=s.length-1;a>=0;a--)c+=a>1?r(s[a],e.precision)+"x^"+a+" + ":1===a?r(s[a],e.precision)+"x + ":r(s[a],e.precision);return{r2:n(t,f),equation:s,points:f,string:c}},lastvalue:function(t,o,e){for(var i=[],u=null,a=0;a<t.length;a++)null!==t[a][1]&&isFinite(t[a][1])?(u=t[a][1],i.push([t[a][0],t[a][1]])):i.push([t[a][0],u]);return{r2:n(t,i),equation:[u],points:i,string:""+r(u,e.precision)}}};return function(n,r,o,e){var i="object"==typeof o&&void 0===e?o:e||{};return i.precision||(i.precision=2),"string"==typeof n?t[n.toLowerCase()](r,o,i):null}})</script><script>var PolyRegression={allpoints:[],clear:function(){for(var t=document.getElementById("pointlist").getElementsByTagName("tbody")[0],e=t.querySelectorAll("tr.pl_calpoint"),i=(e.length,e.length-1);i>=0;i--){var o=e[i];o.parentNode.removeChild(o)}return t},newrow:function(t){var e=this.row.cloneNode(!0);e.querySelector("td.pl_tilt").innerHTML=t[0].toFixed(2),e.querySelector("td.pl_sg").innerHTML=this.plato?t[1].toFixed(2):t[1].toFixed(4),e.querySelector("td.pl_value").innerHTML=this.plato?t[2].toFixed(2):t[2].toFixed(4),e.querySelector("td.pl_error").innerHTML=this.plato?t[3].toFixed(2):(1e3*t[3]).toFixed(1);var i=e.querySelector("input.pl_ignored_cb");i.checked=t[4];var o=this;return i.onchange=function(){o.igchanged(this)},e},igchanged:function(t){for(var e=document.getElementById("pointlist").getElementsByTagName("tbody")[0].querySelectorAll("input.pl_ignored_cb"),i=0,o=0,n=0;n<e.length;n++)e[n].checked?i|=1<<n:o++;o<2?(console.log("less than 2."),t.checked=!1):(this.cal_igmask=i,this.show())},show:function(){this.row||(this.row=Q("#pointlist tr.pl_calpoint"),this.row.parentNode.removeChild(this.row)),this.getFormula();for(var t=this.clear(),e=0;e<this.ptlist.length;e++)t.appendChild(this.newrow(this.ptlist[e]));this.chart()},getFormula:function(){var t=this;if(!(t.allpoints.length<2)){t.points=[];for(var e=0;e<t.allpoints.length;e++)1<<e&t.cal_igmask||t.points.push(t.allpoints[e]);t.points.length<2&&(t.points=t.alpoints,t.cal_igmask=0);var i=regression("polynomial",t.points,t.points.length>3?3:t.points.length>2?2:1,{precision:9});t.regression=i,Q("#polynormial").innerHTML=i.string,t.sgByTilt=t.points.length>3?function(t){return i.equation[0]+i.equation[1]*t+i.equation[2]*t*t+i.equation[3]*t*t*t}:t.points.length>2?function(t){return i.equation[0]+i.equation[1]*t+i.equation[2]*t*t}:function(t){return i.equation[0]+i.equation[1]*t};var o=[];for(e=0;e<t.allpoints.length;e++){var n=t.allpoints[e][0],l=t.allpoints[e][1],r=t.sgByTilt(n),a=l-r,s=0!=(1<<e&t.cal_igmask);o.push([n,l,r,a,s])}t.ptlist=o}},chart:function(){for(var t=[],e=0;e<this.allpoints.length;e++)t.push([this.ptlist[e][0],this.ptlist[e][1],this.ptlist[e][2]]);void 0===this.graph?this.graph=new Dygraph(document.getElementById("graph"),t,{labels:["Tilt","SG","Interpolated"],colors:["rgb(240, 100, 100)","rgb(89, 184, 255)"],series:{SG:{drawPoints:!0,pointSize:4,strokeWidth:0}},axisLabelFontSize:12,gridLineColor:"#ccc",gridLineWidth:"0.1px",strokeWidth:1,xRangePad:10,axes:{y:{axisLabelWidth:40,axisLabelFormatter:function(t){return t.toFixed(3)},valueFormatter:function(t){return t.toFixed(3)}},x:{pixelsPerLabel:30,axisLabelWidth:40}}}):(this.graph.updateOptions({file:t}),this.graph.resize())}};function applyIgnoreMask(){BChart.setIgnoredMask(PolyRegression.cal_igmask)}function openpolynomialpane(){Q("#polynomialpane").style.display="block",PolyRegression.allpoints=BChart.chart.calibrationPoints,PolyRegression.cal_igmask=BChart.chart.cal_igmask,PolyRegression.plato=BChart.chart.plato,PolyRegression.show()}function closepolynomialpane(){Q("#polynomialpane").style.display="none"}</script><script>var JSVERSION = "4.0";

function s_ajax(b) {
    var c = new XMLHttpRequest();
    c.onreadystatechange = function() {
        if (c.readyState == 4) {
            if (c.status == 200) {
                b.success(c.responseText)
            } else {
                c.onerror(c.status)
            }
        }
    };
    c.ontimeout = function() {
        if (typeof b["timeout"] != "undefined") b.timeout();
        else c.onerror(-1)
    }, c.onerror = function(a) {
        if (typeof b["fail"] != "undefined") b.fail(a)
    };
    c.open(b.m, b.url, true);
    if (typeof b["data"] != "undefined") {
        c.setRequestHeader("Content-Type", (typeof b["mime"] != "undefined") ? b["mime"] : "application/x-www-form-urlencoded");
        c.send(b.data)
    } else c.send()
}

var Q = function(d) {
    return document.querySelector(d);
};

function C2F(c) {
    return Math.round((c * 1.8 + 32) * 10) / 10
}

function F2C(f) {
    return Math.round((f - 32) / 1.8 * 10) / 10
}

function openDlgLoading() {
    document.getElementById('dlg_loading').style.display = "block";
}

function closeDlgLoading() {
    document.getElementById('dlg_loading').style.display = "none";
}

var BrewMath = {
    abv: function(og, fg) {
        return ((76.08 * (og - fg) / (1.775 - og)) * (fg / 0.794)).toFixed(1);
    },
    abvP: function(og, fg) {
        return BrewMath.abv(BrewMath.pla2sg(og), BrewMath.pla2sg(fg));
    },
    att: function(og, fg) {
        return Math.round((og - fg) / (og - 1) * 100);
    },
    attP: function(pog, pfg) {
        return Math.round((pog - pfg) / pog * 100);
    },
    sg2pla: function(sg) {
        return (((182.4601 * sg - 775.6821) * sg + 1262.7794) * sg - 669.5622);
    },
    pla2sg: function(pla) {
        return 1 + (pla / (258.6 - ((pla / 258.2) * 227.1)));
    },
    tempCorrectionF(sg, t, c) {
        var nsg = sg * ((1.00130346 - 0.000134722124 * t + 0.00000204052596 * t * t - 0.00000000232820948 * t * t * t) /
            (1.00130346 - 0.000134722124 * c + 0.00000204052596 * c * c - 0.00000000232820948 * c * c * c));
        return nsg;
    },
    pTempCorrectionF(sg, t, c) {
        return BrewMath.sg2pla(BrewMath.tempCorrectionF(BrewMath.pla2sg(sg), t, c));
    },
    tempCorrection(celsius, sg, t, c) {
        return celsius ? BrewMath.tempCorrectionF(sg, C2F(t), C2F(c)) : BrewMath.tempCorrectionF(sg, t, c);
    },
    pTempCorrection(celsius, sg, t, c) {
        return celsius ? BrewMath.pTempCorrectionF(sg, C2F(t), C2F(c)) : BrewMath.tempCorrectionF(sg, t, c);
    }
};

Date.prototype.shortLocalizedString = function() {
    var y = this.getYear() + 1900;
    var re = new RegExp('[^\d]?' + y + '[^\d]?');
    var n = this.toLocaleDateString();
    var ds = n.replace(re, "");
    var HH = this.getHours();
    var MM = this.getMinutes();

    function T(x) {
        return (x > 9) ? x : ("0" + x);
    }
    return ds + " " + T(HH) + ":" + T(MM);
};

function getActiveNavItem() {
    var path = window.location.pathname.split("/").pop();
    if (path == "") path = "index.htm";
    var element = Q('.options>li>a[href="/' + path + '"]');
    element.className += 'active';
}

function formatDate(dt) {
    //	var y = dt.getFullYear();
    //	var M = dt.getMonth() +1;
    //	var d = dt.getDate();
    var h = dt.getHours();
    var m = dt.getMinutes();
    //    var s = dt.getSeconds();
    function dd(n) {
        return (n < 10) ? '0' + n : n;
    }
    //	return dd(M) + "/" + dd(d) + "/" + y +" "+ dd(h) +":"+dd(m)+":"+dd(s);
    //	return dd(M) + "/" + dd(d) +" "+ dd(h) +":"+dd(m);
    return dt.toLocaleDateString() + " " + dd(h) + ":" + dd(m);
}

function formatDateForPicker(date) {
    var h = date.getHours();
    var m = date.getMinutes();

    function dd(n) { return (n < 10) ? '0' + n : n; }
    return date.getFullYear() + "-" + dd(date.getMonth() + 1) + "-" + dd(date.getDate()) + "T" + dd(h) + ":" + dd(m);
}</script><script>function TabPane(e){var t=this;function a(e){var a=document.getElementById(e+"-m");a.className.indexOf("nav-selected")<0&&(a.className+=" nav-selected"),document.getElementById(e+"-s").style.display="block",t.cmode=e}t.cmode=null;for(var n=0;n<e.length;n++){var i=e[n];document.getElementById(i+"-s").style.display="none",document.getElementById(i+"-m").onclick=function(){var e,n,i,s=this.id.replace(/-m$/,"");return e=t.cmode,n=document.getElementById(e+"-m"),i=n.className.replace(/\snav-selected/,""),n.className=i,document.getElementById(e+"-s").style.display="none",a(s),!1}}a(e[0]),t.select=a}var Capper={target_psi:0,psi_valid:!1,hidepset:function(e){this.psi_valid=!e,Q(".psi-set-group").style.display=e?"none":"block"},setpsi:function(e){this.target_psi=e,Q("#cappressure").value=e},init:function(){var e=Q(".capping-info-pane");e&&(e.style.display="none");var t=Q("#capper-frame");t&&(t.style.display="none",this.initCtrl())},initCtrl:function(){var e=this;e.tabs=new TabPane(["tab-gravity","tab-time","tab-manual"]);var t=Q("#captimeinput");e.time=new Date,t.onchange=function(){var a=new Date(t.value);isNaN(a.getTime())?e.setInputTime(e.time):e.setInputTime(a)},Q("#cap-apply").onclick=function(){var t=e.psi_valid?"psi="+e.target_psi+"&":"",a=e.tabs.cmode;if("tab-gravity"==a){var n=Q("#capgravityinput").value;e.send(t+"sg="+n)}else if("tab-time"==a){var i=new Date(Q("#captimeinput").value);if(isNaN(i.getTime()))return void alert("Hora Inválida");e.send(t+"at="+i.getTime()/1e3)}else Q("#capswitch").checked?e.send(t+"cap=1"):e.send(t+"cap=0")},e.hidepset(!0),Q("#cappressure").onchange=function(){e.target_psi=this.value}},send:function(e){console.log("send "+e),s_ajax({url:"cap?"+e,m:"GET",success:function(e){alert("Concluído!!")},fail:function(e){alert("falha ao configurar Spunding")}})},setcap:function(e){Q("#capstate-open")&&(e?(Q("#capstate-open").style.display="none",Q("#capstate-close").style.display="inline-block"):(Q("#capstate-open").style.display="inline-block",Q("#capstate-close").style.display="none"))},setInputTime:function(e){this.time=e;var t=Q("#captimeinput");t.value="datetime-local"==t.type?formatDateForPicker(e):formatDate(e)},status:function(e){void 0!==e.m&&0!=e.m&&(this.statusInfo(e),this.updateCtrl(e))},statusInfo:function(e){var t=Q(".capping-info-pane");if(t){t.style.display="block",this.setcap(e.c);for(var a=["","cs-manopen","cs-mancap","cs-timecon","cs-sgcon"],n=1;n<a.length;n++)n==e.m?Q("#"+a[n]).style.display="inline-block":Q("#"+a[n]).style.display="none";void 0!==e.g&&(Q("#capgravityset").innerHTML=e.g),void 0!==e.t&&(Q("#captimeset").innerHTML=formatDate(new Date(1e3*e.t)))}},updateCtrl:function(e){var t=Q("#capper-frame");t&&(t.style.display="block",void 0!==e.g&&(Q("#capgravityinput").value=e.g),void 0!==e.t?this.setInputTime(new Date(1e3*e.t)):this.setInputTime(new Date),1==e.m?Q("#capswitch").checked=!1:2==e.m&&(Q("#capswitch").checked=!0),2==e.pm&&(this.hidepset(!1),this.setpsi(e.psi)))},tunit:"C",calpsi:function(){"undefined"!=typeof BrewPiSetting&&(this.tunit=BrewPiSetting.tempUnit),Q("#dlg_carbonation").style.display="block"},calCancel:function(){Q("#dlg_carbonation").style.display="none"},calOk:function(){var e=Q("#carcal-psi").innerHTML;isNaN(e)||this.setpsi(e),Q("#dlg_carbonation").style.display="none"},cal:function(){var e=Q("#carcal-vol").value,t=Q("#carcal-temp").value;"C"==this.tunit&&(t=C2F(t));var a=-16.6999-.0101059*t+.00116512*t*t+.173354*t*e+4.24267*e-.0684226*e*e;Q("#carcal-psi").innerHTML=Math.round(a)}}</script><script>var T_CHART_REQUEST=12e3,T_CHART_RETRYTO=6e3,T_CHART_ZERODATA=1e4,T_CHART_REFRESH=2500,T_CHART_RETRY=1e4,T_LOAD_CHART=150,T_BWF_RECONNECT=1e4,T_BWF_LCD=1e4,BChart={offset:0,url:"chart.php",toggle:function(t,e){void 0!==e&&e?this.chart.togglePsiLine(t):this.chart.toggleLine(t)},updateFormula:function(){var t=this.chart.coefficients,e=this.chart.npt<<24|16777215&this.chart.cal_igmask,i=!0;if(void 0!==window.npt&&window.npt==e&&(i=!1),i){var n="coeff?a0="+t[0].toFixed(9)+"&a1="+t[1].toFixed(9)+"&a2="+t[2].toFixed(9)+"&a3="+t[3].toFixed(9)+"&pt="+e;s_ajax({url:n,m:"GET",success:function(t){window.npt=e},fail:function(t){alert("Falha ao atualizar fórmula."+t)}})}},reprocesData:function(){for(var t=this,e=0;e<t.bdata.length;e++)t.chart.process(t.bdata[e])},updateChartResult:function(){var t=this;t.chart.sg&&!isNaN(t.chart.sg)&&(updateGravity(t.chart.sg),t.chart.sg=NaN,checkfgstate()),t.chart.updateChart()},setIgnoredMask:function(t){var e=this;e.chart.cal_igmask!=t&&(e.chart.calculateSG=!1,e.reprocesData(),e.chart.cal_igmask=t,e.chart.getFormula(),e.reprocesData(),e.updateChartResult(),e.chart.cal_igmask=t,e.updateFormula())},reqdata:function(){var t=this,e="offset="+t.offset;void 0!==t.startOff&&null!==t.startOff&&(e=e+"&index="+t.startOff);var i=new XMLHttpRequest;i.open("GET",t.url+"?"+e),i.timeout=T_CHART_REQUEST,i.responseType="arraybuffer",i.onload=function(e){if(404!=this.status){var n=new Uint8Array(this.response);if(t.offset?t.bdata.push(n):t.bdata=[n],0==n.length)return t.timer&&clearInterval(t.timer),t.timer=null,void setTimeout(function(){t.reqdata()},T_CHART_ZERODATA);var o=t.chart.process(n);if(o.nc)t.offset=n.length,t.startOff=i.getResponseHeader("LogOffset"),t.chart.calibrating&&(t.chart.getFormula(),t.chart.process(n),t.chart.calculateSG&&(Q("#formula-btn").style.display="block",t.updateFormula()));else if(t.offset+=n.length,t.chart.calibrating&&o.sg)return console.log("New SG availbe. reprocess"),t.chart.calculateSG=!1,t.reprocesData(),t.chart.getFormula(),t.reprocesData(),t.updateChartResult(),void t.updateFormula();t.chart.updateChart(),isNaN(t.chart.og)||(updateOriginGravity(t.chart.og),t.chart.og=NaN),t.chart.sg&&!isNaN(t.chart.sg)&&(updateGravity(t.chart.sg),t.chart.sg=NaN,checkfgstate()),null==t.timer&&t.settimer()}else console.log(" Error getting log data")},i.ontimeout=function(e){console.error("Timeout!"+new Date),null==t.timer&&setTimeout(function(){t.reqdata()},T_CHART_RETRYTO)},i.onerror=function(){console.log("Error getting data"),null==t.timer&&setTimeout(function(){t.reqdata()},T_CHART_RETRY)},i.send()},settimer:function(){var t=this;t.timer=setInterval(function(){t.reqdata()},1e3*t.chart.interval)},init:function(t,e,i,n,o,r){this.chart=new BrewChart(t),this.chart.setLabels(e,i),void 0!==n&&this.chart.setPChart(n,o,r)},timer:null,start:function(){this.running||(this.running=!0,this.offset=0,this.reqdata())},reqnow:function(){var t=this;t.timer&&clearInterval(t.timer),t.timer=null,t.reqdata()}};function parseStatusLine(t){var e={},i=0,n=[/Idling\s+for\s+(\S+)\s*$/i,/control\s+OFF/i,/Door\s+Open/i,/Heating\s+for\s+(\S+)\s*$/i,/Cooling\s+for\s+(\S+)\s*$/i,/Wait\s+to\s+Cool\s+(\S+)\s*$/i,/Wait\s+to\s+Heat\s+(\S+)\s*$/i,/Waiting\s+for\s+Peak/i,/Cool\s+Time\s+left\s+(\S+)\s*$/i,/Heat\s+Time\s+left\s+(\S+)\s*$/i];for(e.ControlStateSince="",i=0;i<n.length;i++){var o=n[i].exec(t);if(o){void 0!==o[1]&&(e.ControlStateSince=o[1]);break}}return e.ControlState=i,e.StatusLine=t,e}function renderLcdText(t){var e=Q(".error");function i(e){return e<-1e4?"--.-":(e/100).toFixed(1)+"&deg;"+t.tu}e&&(e.style.display="none");var n=parseStatusLine(t.sl);n.ControlMode=t.md,n.unit=t.tu,n.BeerTemp=i(t.bt),n.BeerSet=i(t.bs),n.FridgeTemp=i(t.ft),n.FridgeSet=i(t.fs),n.RoomTemp=i(t.rt);var o={o:"Desligado",b:"Sensor Cerveja",f:"Sensor Refrig.",p:"Perfil de Fermentação",i:"Invalid"},r=["Inativo por {time}","Controle de Temp. Desligado","Porta Aberta","Aquecendo durante {time}","Esfriando durante {time}","Aguardando para Esfriar {time}","Aguardando para Aquecer {time}","Aguardando Pico","Tempo Restante Esfriando {time}","Tempo Restante Aquecendo {time}","Status Inválido"];if(Object.keys(n).map(function(t,e){var i=Q("#lcd"+t);i&&(i.innerHTML="ControlMode"==t?o[n[t]]:"ControlState"==t?function(t,e){if(void 0===e)return r[t];var i,n="";return(i=/(\d+)h(\d\d)m(\d\d)/.exec(e))?n="{HH}h{MM}m{SS}".replace("{SS}",i[3]).replace("{MM}",i[2]).replace("{HH}",i[1]):(i=/(\d+)m(\d\d)/.exec(e))&&(n="{MM}m{SS}".replace("{SS}",i[2]).replace("{MM}",i[1])),r[t].replace("{time}",n)}(n[t],n.ControlStateSince):n[t])}),void 0!==n.unit&&(window.tempUnit=n.unit),void 0!==n.BeerTemp){var a=/([\d\.]+)/.exec(n.BeerTemp);a.length>0&&(window.beerTemp=a[0])}}var roomOfridge=!1;function simLcd(t){function e(t){if(t<-1e4)return" --.-";for(var e=(t/100).toFixed(1),i="",n=e.length;n<5;n++)i+=" ";return i+e}var i=[];return i[0]="Mode   "+{o:"Off",b:"Beer Const.",f:"Fridge Const.",p:"Beer Profile",i:"Invalid"}[t.md],i[1]="Beer  "+e(t.bt)+" "+e(t.bs)+" &deg;"+t.tu,t.rt>-1e4&&roomOfridge?i[2]="Room  "+e(t.rt)+" "+e(-2e4)+" &deg;"+t.tu:i[2]="Fridge"+e(t.ft)+" "+e(t.fs)+" &deg;"+t.tu,roomOfridge=!roomOfridge,i[3]=t.sl,i}function displayLcdText(t){for(var e=0;e<4;e++){var i=document.getElementById("lcd-line-"+e);i&&(i.innerHTML=t[e])}}function displayLcd(t){window.tempUnit=t.tu,displayLcdText(simLcd(t)),renderLcdText(t)}function hideErrorMsgs(){for(var t=document.querySelectorAll(".errormsg"),e=0;e<t.length;e++)t[e].style.display="none"}function communicationError(){var t=Q(".error");t?(hideErrorMsgs(),Q("#error_connect").style.display="block",t.style.display="block"):displayLcdText(["Failed to","connect to","Server",""])}function controllerError(){var t=Q(".error");t?(hideErrorMsgs(),Q("#error_noupdate").style.display="block",t.style.display="block"):displayLcdText(["Controller not","updating data","...",""])}function checkTime(t,e){var i=new Date,n=0-60*i.getTimezoneOffset(),o=Math.round(i.getTime()/1e3);(e!=n||Math.abs(o-t)>1800)&&s_ajax({url:"time",m:"POST",mime:"application/x-www-form-urlencoded",data:"time="+o+"&off="+n,success:function(){}})}function gravityDevice(t){if(void 0!==t.plato&&(window.plato=t.plato,window.plato&&showPlatoUnit()),void 0!==t.fpt&&(window.npt=t.fpt),void 0!==t.name)if(void 0!==t.lu){t.name.startsWith("iSpindel")&&void 0===window.iSpindel&&(window.iSpindel=!0,Q("#iSpindel-pane")&&(Q("#iSpindel-pane").style.display="block"));var e,i=Q("#iSpindel-name");i&&(i.innerHTML=t.name),void 0!==t.battery&&Q("#iSpindel-battery")&&(Q("#iSpindel-battery").innerHTML=t.battery),e=void 0!==t.lu?new Date(1e3*t.lu):new Date,Q("#iSpindel-last")&&(Q("#iSpindel-last").innerHTML=e.shortLocalizedString()),!BChart.chart.calibrating&&void 0!==t.sg&&t.sg>0&&updateGravity(t.sg),void 0!==t.angle&&Q("#iSpindel-tilt")&&(Q("#iSpindel-tilt").innerHTML=""+t.angle),void 0!==t.rssi&&Q("#ispindel-rssi")&&(Q("#ispindel-rssi").classList.remove("no-display"),wifibar("#ispindel-rssi",t.rssi)),void 0!==t.lpf&&GravityFilter.setBeta(t.lpf),void 0!==t.stpt&&GravityTracker.setThreshold(t.stpt),void 0!==t.ctemp&&(window.caltemp=t.ctemp)}else console.log("iSpindel:"+JSON.stringify(t))}function updateGravity(t){window.sg=t,Q("#gravity-sg").innerHTML=window.plato?t.toFixed(1):t.toFixed(3),void 0!==window.og&&(Q("#gravity-att").innerHTML=window.plato?BrewMath.attP(window.og,t):BrewMath.att(window.og,t),Q("#gravity-abv").innerHTML=window.plato?BrewMath.abvP(window.og,t):BrewMath.abv(window.og,t))}function updateOriginGravity(t){void 0!==window.og&&window.og==t||(window.og=t,Q("#gravity-og").innerHTML=window.plato?t.toFixed(1):t.toFixed(3),void 0!==window.sg&&updateGravity(window.sg))}function showgravitydlg(t){if(Q("#dlg_addgravity .og").style.display="none",Q("#dlg_addgravity .sg").style.display="none",Q("#dlg_addgravity ."+t).style.display="block",Q("#dlg_addgravity").style.display="block",void 0!==window.tempUnit){window.celsius=!1;var e=68;/C$/.test(window.tempUnit)&&(window.celsius=!0,e=20),Q("#dlg_addgravity .tempinput").value=e;for(var i=document.querySelectorAll("#dlg_addgravity .temp-unit"),n=0;n<i.length;n++)i[n].innerHTML=window.tempUnit}else window.celsius=!0}function dismissgravity(){Q("#dlg_addgravity").style.display="none"}function inputsg_change(){var t=parseFloat(Q("#dlg_addgravity .sginput").value),e=parseFloat(Q("#dlg_addgravity .tempinput").value);if(!isNaN(t)&&!isNaN(e)){var i=void 0!==window.caltemp?window.caltemp:20;if(i=window.celsius?i:C2F(i),Q("#sginput-hm-cal-temp").innerHTML=i,window.plato){var n=BrewMath.pTempCorrection(window.celsius,t,e,i);Q("#sginput-hmc").innerHTML=n.toFixed(2)}else{n=BrewMath.tempCorrection(window.celsius,t,e,i);Q("#sginput-hmc").innerHTML=n.toFixed(3)}if(void 0!==window.beerTemp)if(Q("#sginput-ispindel-temp").innerHTML=window.beerTemp,window.plato){var o=BrewMath.pTempCorrection(window.celsius,t,e,window.beerTemp);Q("#sginput-sg-ispindel").innerHTML=o.toFixed(2)}else{o=BrewMath.tempCorrection(window.celsius,t,e,window.beerTemp);Q("#sginput-sg-ispindel").innerHTML=o.toFixed(3)}}}function inputgravity(){var t=parseFloat(Q("#sginput-hmc").innerHTML);if(window.plato||!(t<.8||t>1.25)){dismissgravity(),openDlgLoading(),window.isog?updateOriginGravity(t):updateGravity(t);var e={name:"webjs",gravity:t};window.isog&&(e.og=1),window.plato&&(e.plato=1),s_ajax({url:"gravity",m:"POST",mime:"application/json",data:JSON.stringify(e),success:function(t){closeDlgLoading(),setTimeout(function(){BChart.chart.calibrating&&BChart.reqnow()},T_CHART_REFRESH)},fail:function(t){alert("falha:"+t),closeDlgLoading()}})}}function inputSG(){window.isog=!1,showgravitydlg("sg")}function inputOG(){window.isog=!0,showgravitydlg("og")}function wifibar(t,e){for(var i=[-1e3,-90,-80,-70,-67],n=4;n>=0&&!(i[n]<e);n--);for(var o=Q(t).getElementsByClassName("rssi-bar"),r=0;r<o.length;r++)o[r].style.backgroundColor=r<n?window.rssiBarColor:"rgba(255,255,255,0.05)";Q(t).title=e>0?"?":Math.min(Math.max(2*(e+100),0),100)}function displayrssi(t){Q("#rssi").title=t>0?"?":Math.min(Math.max(2*(t+100),0),100),wifibar("#rssi",t),Q("#wifisignal")&&(Q("#wifisignal").innerHTML=t>0?"?":Math.min(Math.max(2*(t+100),0),100))}function initRssi(){var t=Q("#rssi");window.rssiBarColor=window.getComputedStyle(Q(".rssi-bar1")).getPropertyValue("background-color"),Q("#wifisignal")&&(t.onmouseover=function(){Q("#wifisignal").style.display="block"},t.onmouseout=function(){Q("#wifisignal").style.display="none"})}function ptcshow(t){if(void 0!==t.ptc&&void 0!==t.pt){var e=t.ptc,i=t.pt,n=Q("#ptc-pane");if(n){n.style.display="o"==e?"none":"block";var o=Q("#ptc-state");o&&(o.style.backgroundColor="c"==e?"lightgreen":"gray");var r=Q("#ptc-state-idle");if(r){var a=Q("#ptc-state-run");"c"==e?(r.style.display="none",a.style.display="block"):(r.style.display="block",a.style.display="none")}var s,l,d,c=Q("#ptc-time");if(c&&(c.innerHTML=(s=i,l=Math.floor(s/3600),d=Math.floor((s-3600*l)/60),(l?l+"H":"")+(l+d?d+"M":"")+(s-3600*l-60*d)+"S")),void 0!==t.ptctp){var p=Q("#ptc-temp");p&&(p.innerHTML=t.ptctp<-100?"NA":t.ptctp/100+"&deg;C")}if(void 0!==t.ptclo&&void 0!==t.ptcup){var g=Q("#ptc-set");g&&(g.innerHTML=t.ptclo/100+" ~ "+t.ptcup/100+"&deg;C")}}}}function showPlatoUnit(){for(var t=document.querySelectorAll(".platounit"),e=0;e<t.length;e++)t[e].style.display="inline-block"}function BPLMsg(t){BWF.gotMsg=!0,void 0!==t.rssi&&displayrssi(t.rssi),void 0!==t.sl&&displayLcd(t),void 0!==t.reload&&(console.log("Forced reload chart"),BChart.reqnow(),Q("#recording").innerHTML&&Q("#recording").innerHTML==t.log||(window.npt=0)),void 0!==t.nn&&(Q("#hostname").innerHTML=t.nn,document.title=t.nn),void 0!==t.ver&&(JSVERSION!=t.ver&&alert("Versão incompatível! Recarregue a página."),Q("#verinfo").innerHTML="v"+t.ver),void 0!==t.tm&&void 0!==t.off&&checkTime(t.tm,t.off),void 0!==t.log&&(Q("#recording").innerHTML=t.log),void 0!==t.cap&&Capper.status(t.cap),void 0!==t.plato&&(window.plato=t.plato,window.plato&&showPlatoUnit()),void 0!==t.pm&&void 0!==t.psi&&0!=t.pm&&(Q("#pressure-info-pane").style.display="block",Q("#pressure-psi").innerHTML=t.psi),ptcshow(t)}function connBWF(){BWF.init({onconnect:function(){BWF.send("c"),window.lcdTimer&&clearInterval(window.lcdTimer),window.lcdTimer=setInterval(function(){if(!BWF.gotMsg){if(window.rcTimeout){if(BWF.rcCount++,console.log("rcTimeout failed."),BWF.rcCount<3)return;clearTimer(window.rcTimeout)}return controllerError(),window.rcTimeout=setTimeout(function(){window.rcTimeout=null,BWF.gotMsg||BWF.reconnect(!0)},T_BWF_RECONNECT),void(BWF.rcCount=0)}BWF.gotMsg=!1},T_BWF_LCD)},error:function(t){communicationError(),closeDlgLoading()},handlers:{A:BPLMsg,G:function(t){gravityDevice(t)},C:function(t){"undefined"!=typeof ccparameter&&ccparameter(t)},B:function(t){"undefined"!=typeof rcvBeerProfile&&rcvBeerProfile(t)}}})}function init_classic(){window.plato=!1,BChart.init("div_g",Q("#ylabel").innerHTML,Q("#y2label").innerHTML),initRssi(),Capper.init(),BWF.gotMsg=!0,initctrl_C(),connBWF(),setTimeout(function(){BChart.start()},T_LOAD_CHART)}function init(){Q("#pressure-info-pane").style.display="none",window.plato=!1,BChart.init("div_g",Q("#ylabel").innerHTML,Q("#y2label").innerHTML,"div_p",Q("#psilabel").innerHTML,Q("#vollabel").innerHTML),initRssi(),Capper.init(),BWF.gotMsg=!0,connBWF(),setTimeout(function(){BChart.start()},T_LOAD_CHART),getActiveNavItem()}</script><style>.dygraph-legend{position:absolute;font-size:14px;z-index:10;width:250px;background:#fff;line-height:normal;text-align:left;overflow:hidden}.dygraph-legend-line{display:inline-block;position:relative;bottom:.5ex;padding-left:1em;height:1px;border-bottom-width:2px;border-bottom-style:solid}.dygraph-legend-dash{display:inline-block;position:relative;bottom:.5ex;height:1px;border-bottom-width:2px;border-bottom-style:solid}.dygraph-roller{position:absolute;z-index:10}.dygraph-annotation{position:absolute;z-index:10;overflow:hidden}.dygraph-default-annotation{border:1px solid #000;background-color:#fff;text-align:center}.dygraph-axis-label{z-index:10;line-height:normal;overflow:hidden;color:#000}.dygraph-title{font-weight:700;z-index:10;text-align:center}.dygraph-xlabel{text-align:center}.dygraph-label-rotate-left{text-align:center;transform:rotate(90deg);-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-o-transform:rotate(90deg);-ms-transform:rotate(90deg)}.dygraph-label-rotate-right{text-align:center;transform:rotate(-90deg);-webkit-transform:rotate(-90deg);-moz-transform:rotate(-90deg);-o-transform:rotate(-90deg);-ms-transform:rotate(-90deg)}</style><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet><style>*{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body,html{height:100%}a{text-decoration:none}html{line-height:1.5;font-family:Roboto,sans-serif;font-weight:400;color:rgba(0,0,0,.87)}@media only screen and (min-width:0){html{font-size:14px}}@media only screen and (min-width:992px){html{font-size:14.5px}}@media only screen and (min-width:1200px){html{font-size:15px}}h1,h2,h3,h4,h5,h6{font-weight:400;line-height:1.1}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:inherit}h1{font-size:4.2rem;line-height:110%;margin:2.1rem 0 1.68rem 0}h2{font-size:3.56rem;line-height:110%;margin:1.78rem 0 1.424rem 0}h3{font-size:2.92rem;line-height:110%;margin:1.46rem 0 1.168rem 0}h4{font-size:2.28rem;line-height:110%;margin:1.14rem 0 .912rem 0}h5{font-size:1.64rem;line-height:110%;margin:.82rem 0 .656rem 0}h6{font-size:1rem;line-height:110%;margin:.5rem 0 .4rem 0}em{font-style:italic}strong{font-weight:500}small{font-size:75%}.light{font-weight:300}.thin{font-weight:200}html [layout],html [layout][horizontal],html [layout][vertical]{display:-webkit-box;display:-ms-flexbox;display:flex}html [layout][horizontal]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}html [layout][vertical]{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}html [flex]{-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-preferred-size:.000000001px;flex-basis:.000000001px}html [layout][center-center],html [layout][cross-center]{-webkit-box-align:center;-ms-flex-align:center;align-items:center}html [layout][cross-end]{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}html [layout][center-center],html [layout][main-center]{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}html [layout][main-justified]{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}html [layout][main-distributed]{-ms-flex-pack:distribute;justify-content:space-around}html [hidden]{display:none!important}html [relative]{position:relative}.header{height:64px;background:#009688;-webkit-box-shadow:0 0 4px rgba(0,0,0,.14),0 4px 8px rgba(0,0,0,.28);box-shadow:0 0 4px rgba(0,0,0,.14),0 4px 8px rgba(0,0,0,.28);padding:0 16px;z-index:2}.header_title{font-size:32px;line-height:64px;color:#fff;margin:0;padding:0}.header_version-display{font-size:14px;color:#fff}@media (max-width:700px){[navigation] [menuToggle]{display:block;position:relative;z-index:1;top:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}}[navigation] input{display:none}@media (max-width:700px){[navigation] input{display:block;width:40px;height:32px;position:absolute;top:-7px;left:-5px;cursor:pointer;opacity:0;z-index:2;-webkit-touch-callout:none}[navigation] input:checked~ul{-webkit-transform:scale(1,1);transform:scale(1,1);opacity:1}[navigation] input:checked~span{opacity:1;-webkit-transform:rotate(45deg) translate(-2px,-1px);transform:rotate(45deg) translate(-2px,-1px);background:#232323}[navigation] input:checked~span:nth-last-child(3){opacity:0;-webkit-transform:rotate(0) scale(.2,.2);transform:rotate(0) scale(.2,.2)}[navigation] input:checked~span:nth-last-child(2){opacity:1;-webkit-transform:rotate(-45deg) translate(0,-1px);transform:rotate(-45deg) translate(0,-1px)}}[navigation] span{display:none}@media (max-width:700px){[navigation] span{display:block;width:33px;height:4px;margin-bottom:5px;position:relative;background:#fff;border-radius:3px;z-index:1;-webkit-transform-origin:4px 0;transform-origin:4px 0;-webkit-transition:background .5s cubic-bezier(.77,.2,.05,1),opacity .55s ease,-webkit-transform .5s cubic-bezier(.77,.2,.05,1);transition:background .5s cubic-bezier(.77,.2,.05,1),opacity .55s ease,-webkit-transform .5s cubic-bezier(.77,.2,.05,1);transition:transform .5s cubic-bezier(.77,.2,.05,1),background .5s cubic-bezier(.77,.2,.05,1),opacity .55s ease;transition:transform .5s cubic-bezier(.77,.2,.05,1),background .5s cubic-bezier(.77,.2,.05,1),opacity .55s ease,-webkit-transform .5s cubic-bezier(.77,.2,.05,1)}[navigation] span:first-child{-webkit-transform-origin:0 0;transform-origin:0 0}[navigation] span:nth-last-child(2){-webkit-transform-origin:0 100%;transform-origin:0 100%}}[navigation] .options{list-style-type:none;height:100%}[navigation] .options>li{display:inline-block;height:100%}[navigation] .options a{color:#fff;text-transform:uppercase;height:100%;padding:8px;display:inline-block;line-height:48px;border-bottom:3px solid transparent}[navigation] .options a.active{border-bottom:3px solid #ffc107}[navigation] .options a:hover{border-bottom:3px solid #fff}@media (max-width:700px){[navigation] .options{padding-top:64px;position:fixed;display:block;width:100vw;height:100vh;right:0;top:0;background:#ededed;list-style-type:none;-webkit-font-smoothing:antialiased;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translate(100%,0);transform:translate(100%,0);-webkit-transition:-webkit-transform .5s cubic-bezier(.77,.2,.05,1);transition:-webkit-transform .5s cubic-bezier(.77,.2,.05,1);transition:transform .5s cubic-bezier(.77,.2,.05,1);transition:transform .5s cubic-bezier(.77,.2,.05,1),-webkit-transform .5s cubic-bezier(.77,.2,.05,1)}[navigation] .options>li{display:block;height:auto;text-align:center}[navigation] .options a{color:#222;height:auto;width:100%;display:block}[navigation] .options a.active{color:#ffc107;border:none}[navigation] .options a:hover{background:#ccc;border:none}}.footer{height:40px;background:#222;color:rgba(255,255,255,.87);padding:0 16px}.footer a{color:rgba(255,255,255,.87);font-weight:700}[viewport]{min-height:calc(100% - 104px)}@media (max-width:900px){[viewport]{-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-ms-flex-direction:column!important;flex-direction:column!important;min-height:0}}[main]{padding:16px;overflow-y:auto}@media (max-width:900px){[main]{overflow:initial}}@media (max-width:599px){[main]>[layout] .chart-legend{width:100%}}@media (max-width:599px){[main]>[layout]{-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-ms-flex-direction:column!important;flex-direction:column!important}}.error{position:fixed;left:20px;bottom:50px;background-color:#323232;padding:12px 24px 17px 24px;vertical-align:middle;color:#fff;-webkit-box-shadow:0 7px 18px rgba(0,0,0,.2);box-shadow:0 7px 18px rgba(0,0,0,.2)}.error:empty{display:none}input[type=datetime-local],input[type=number],input[type=password],input[type=text]{width:100%;max-width:280px;margin:16px 0;display:block;border:none;padding:18px 0 10px;border-bottom:solid 1px #009688;-webkit-transition:all .3s cubic-bezier(.64,.09,.08,1);transition:all .3s cubic-bezier(.64,.09,.08,1);background:-webkit-gradient(linear,left top,left bottom,color-stop(96%,rgba(255,255,255,0)),color-stop(4%,#009688));background:linear-gradient(to bottom,rgba(255,255,255,0) 96%,#009688 4%);background-position:-100% 0;background-size:100% 100%;background-repeat:no-repeat;color:#00302c}input[type=datetime-local]:focus,input[type=number]:focus,input[type=password]:focus,input[type=text]:focus{-webkit-box-shadow:none;box-shadow:none;outline:0;background-position:0 0}input[type=datetime-local]:focus::-webkit-input-placeholder,input[type=number]:focus::-webkit-input-placeholder,input[type=password]:focus::-webkit-input-placeholder,input[type=text]:focus::-webkit-input-placeholder{color:#009688;font-size:11px;-webkit-transform:translateY(-20px);transform:translateY(-20px);visibility:visible!important;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}input[type=datetime-local]:focus:-ms-input-placeholder,input[type=number]:focus:-ms-input-placeholder,input[type=password]:focus:-ms-input-placeholder,input[type=text]:focus:-ms-input-placeholder{color:#009688;font-size:11px;transform:translateY(-20px);visibility:visible!important;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}input[type=datetime-local]:focus::-ms-input-placeholder,input[type=number]:focus::-ms-input-placeholder,input[type=password]:focus::-ms-input-placeholder,input[type=text]:focus::-ms-input-placeholder{color:#009688;font-size:11px;transform:translateY(-20px);visibility:visible!important;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}input[type=datetime-local]:focus::placeholder,input[type=number]:focus::placeholder,input[type=password]:focus::placeholder,input[type=text]:focus::placeholder{color:#009688;font-size:11px;-webkit-transform:translateY(-20px);transform:translateY(-20px);visibility:visible!important;-webkit-transition:all .3s ease-in-out;transition:all .3s ease-in-out}input[type=datetime-local]:invalid,input[type=number]:invalid,input[type=password]:invalid,input[type=text]:invalid{background:-webkit-gradient(linear,left top,left bottom,color-stop(96%,rgba(255,255,255,0)),color-stop(4%,red));background:linear-gradient(to bottom,rgba(255,255,255,0) 96%,red 4%)}.hide{display:none!important}.switch-input{display:none}.switch-label{position:relative;display:inline-block;min-width:148px;cursor:pointer;font-weight:500;text-align:left;margin:0;padding:4px 0 4px 44px}.switch-label:after,.switch-label:before{content:"";position:absolute;margin:0;outline:0;top:50%;-webkit-transform:translate(0,-50%);transform:translate(0,-50%);-webkit-transition:all .3s ease;transition:all .3s ease}.switch-label:before{left:1px;width:34px;height:14px;background-color:#ddd;border-radius:8px}.switch-label:after{left:0;width:20px;height:20px;background-color:#fafafa;border-radius:50%;-webkit-box-shadow:0 3px 1px -2px rgba(0,0,0,.14),0 2px 2px 0 rgba(0,0,0,.098),0 1px 5px 0 rgba(0,0,0,.084);box-shadow:0 3px 1px -2px rgba(0,0,0,.14),0 2px 2px 0 rgba(0,0,0,.098),0 1px 5px 0 rgba(0,0,0,.084)}.switch-input:checked+.switch-label:after{background-color:#4caf50;-webkit-transform:translate(80%,-50%);transform:translate(80%,-50%)}.switch-input:checked+label[for=beer-temp].switch-label:after{background-color:#29aa29}.switch-input:checked+label[for=beer-set].switch-label:after{background-color:#f06464}.switch-input:checked+label[for=fridge-temp].switch-label:after{background-color:#59b8ff}.switch-input:checked+label[for=fridge-set].switch-label:after{background-color:#ffa14c}.switch-input:checked+label[for=room-temp].switch-label:after{background-color:#aaa}.switch-input:checked+label[for=gravity].switch-label:after{background-color:#909}.switch-input:checked+label[for=aux-temp].switch-label:after{background-color:#f5e127}.switch-input:checked+label[for=filtersg].switch-label:after{background-color:#000abb}.switch-input:checked+label[for=pressure].switch-label:after{background-color:#00e}.switch-input:checked+label[for=pressure-set].switch-label:after{background-color:#f06464}.switch-input:checked+label[for=carbonation].switch-label:after{background-color:#aaa}.modal{display:none;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:fixed;top:0;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:hidden;z-index:1000;-webkit-transition:all .5s cubic-bezier(.23,1,.32,1);transition:all .5s cubic-bezier(.23,1,.32,1);-webkit-transition-delay:0s;transition-delay:0s;background:rgba(0,0,0,.3)}.modal-content{position:relative;padding:2.4rem;background:#fff;background-clip:padding-box;-webkit-box-shadow:0 12px 15px 0 rgba(0,0,0,.25);box-shadow:0 12px 15px 0 rgba(0,0,0,.25);-webkit-transition:all .25s cubic-bezier(.23,1,.32,1);transition:all .25s cubic-bezier(.23,1,.32,1);max-width:600px;padding:2rem}.modal-content h2.message{font-size:18px;font-weight:700;text-transform:uppercase}.btn{display:inline-block;position:relative;cursor:pointer;height:35px;line-height:35px;padding:0 1.5rem;font-size:15px;font-weight:600;letter-spacing:.8px;text-align:center;text-transform:uppercase;vertical-align:middle;white-space:nowrap;outline:0;border:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transition:all .3s ease-out;transition:all .3s ease-out;background-color:transparent;margin-right:8px}.btn[disabled]{color:#bdbdbd}.btn[disabled]:hover{background-color:transparent;cursor:not-allowed}.btn--raised{background-color:#009688;color:#fff;-webkit-box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}.btn--raised:hover{background-color:#00635a}.btn--primary{color:#009688}.btn:hover{background-color:rgba(153,153,153,.2);cursor:pointer}[side]{-webkit-box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);width:300px;padding:16px;overflow-y:auto;background:#eee}@media (max-width:900px){[side]{width:100%;-webkit-box-ordinal-group:6;-ms-flex-order:5;order:5}}.data-pane{list-style-type:none;display:block}.data-pane .heading{border-bottom:1px solid rgba(0,0,0,.64);padding-top:8px;padding-bottom:4px;margin-bottom:4px}.data-pane .heading strong{text-transform:uppercase;display:inline-block}.data-pane .heading #lcdControlState:empty+.for{display:none}.chart{width:calc(100% - 280px)}@media (max-width:599px){.chart{width:100%;margin-bottom:16px}}.chart-main{height:390px}.chart-p{height:130px}.chart-legend{list-style-type:none;width:280px}.chart-legend-row{padding:8px 16px 0 16px}.chart-legend-row>div{display:inline-block}.chart-legend-row .toggle{width:12px;height:12px;margin-right:8px;border-radius:100%;border:1px solid #000}.chart-legend-row .toggle:hover{cursor:pointer}.chart-legend-row.time{background-color:#def;padding-bottom:8px}.pressure-group{visibility:hidden}#gravity-og:hover,#gravity-sg:hover{cursor:pointer}.legend-label{width:100px;font-weight:700}.legend-label:hover{cursor:pointer}#formula-btn{float:right;display:none;font-style:italic;text-decoration:underline}#formula-btn:hover{cursor:pointer}#polynomialpane .modal-content{position:relative;max-width:800px}#pointlist{border-collapse:collapse}#pointlist th{border:solid 1px}#pointlist td{border:solid 1px;border-collapse:collapse}#xclose{float:right;font-size:14px;color:red}#xclose:hover{cursor:pointer}.wifi-bars{position:relative;height:16px;width:24px;display:inline-block}.no-display{display:none}#wifisignal{font-size:12pt;color:#000;font-family:Courier New,Courier,monospace;position:absolute;top:6px;left:4px;display:none}.rssi-bar{position:absolute;bottom:0;float:left;width:4px;border-radius:1px;background-color:#444}.rssi-bar1{height:4px;left:0}.rssi-bar2{height:8px;left:6px}.rssi-bar3{height:12px;left:12px}.rssi-bar4{height:16px;left:18px}#fgstate{width:10px;height:10px;border-radius:50%;margin:6px 0 0 0;border:0}.platounit{display:none}</style></head><body onload=init()><header layout horizontal main-justified cross-center relative class=header><h1 class=header_title><span id=hostname>BrewPiLess</span> <span id=verinfo class=header_version-display></span></h1><div navigation><div menutoggle><input type=checkbox> <span></span> <span></span> <span></span><ul class=options><li><a href=/index.htm> gráfico </a></li><li><a href=/control.htm> modos de fermentação </a></li><li><a href=/logging.htm> registros </a></li><li><a href=/setup.htm> dispositivos </a></li><li><a href=/config.htm> rede </a></li><li><a href=/gravity.htm> densidade </a></li><li><a href=/pressure.htm> Pressão </a></li></ul></div></div></header><div style=display:none><span id=ylabel>Temperatura</span><span id=y2label>Densidade</span><span id=psilabel>Pressure(psi)</span><span id=vollabel>CO2 Vol</span></div><div viewport layout horizontal><div side><div id=status class=status-display><ul id=status-pane class="data-pane status-pane"><li class=heading layout horizontal main-justified><strong>Estado:</strong><div style=display:inline-block><strong id=lcdControlState></strong></div></li><li layout horizontal main-justified><span class=descriptor>Modo:</span><span id=lcdControlMode></span></li><li layout horizontal main-justified><span class=descriptor>Temp. Cerveja:</span><span id=lcdBeerTemp></span></li><li layout horizontal main-justified><span class=descriptor>SP Cerveja:</span><span id=lcdBeerSet></span></li><li layout horizontal main-justified><span class=descriptor>Temp. Refrigeração:</span><span id=lcdFridgeTemp></span></li><li layout horizontal main-justified><span class=descriptor>SP Refrigeração:</span><span id=lcdFridgeSet></span></li><li layout horizontal main-justified><span class=descriptor>Temp. Ambiente:</span><span id=lcdRoomTemp></span></li></ul></div><ul id=gravity-pane class="data-pane gravity-pane"><li class=heading><strong>Densidade:</strong></li><li layout horizontal main-justified><span class=descriptor>Densidade Original (OG):</span><span><span id=gravity-og onclick=inputOG()>--</span><span class=platounit>&deg;P</span></span></li><li layout horizontal main-justified><span class=descriptor>Densidade Específica (SG):</span><span><span id=gravity-sg onclick=inputSG()>--</span><span class=platounit>&deg;P</span></span></li><li layout horizontal main-justified><span class=descriptor>Densidade Final (FG):</span><div id=fgstate></div></li><li layout horizontal main-justified><span class=descriptor>Aten.:</span><span><span id=gravity-att>--</span>%</span></li><li layout horizontal main-justified><span class=descriptor>ABV:</span><span><span id=gravity-abv>--</span>%</span></li></ul><ul class="data-pane ispindle-pane"><li class=heading><strong>iSpindel:</strong></li><li layout horizontal main-justified><span class=descriptor>Inclinação:</span><span id=iSpindel-tilt>--</span></li><li layout horizontal main-justified><span class=descriptor>Bateria:</span><span id=iSpindel-battery>--</span></li><li layout horizontal main-justified id=ispindel-rssi-line><span class=descriptor>Qualidade do Sinal (Wi-Fi):</span><div id=ispindel-rssi class="wifi-bars no-display"><div class="rssi-bar rssi-bar1"></div><div class="rssi-bar rssi-bar2"></div><div class="rssi-bar rssi-bar3"></div><div class="rssi-bar rssi-bar4"></div></div></li><li layout horizontal main-justified><span class=descriptor>Última Atualização:</span><span id=iSpindel-last>--</span></li></ul><ul class="data-pane ptc-pane" id=ptc-pane style=display:none><li class=heading layout horizontal main-justified><strong>Controle Temp. Glicol:</strong><div style=display:inline-block><strong><span id=ptc-state-idle>INATIVO</span><span id=ptc-state-run style=display:none>ATIVO</span></strong></div></li><li layout horizontal main-justified><span class=descriptor></span> por <span id=ptc-time></span></li><li layout horizontal main-justified><span class=descriptor>Variação:</span><span id=ptc-set></span></li></ul><ul class="data-pane capping-info-pane"><li class=heading layout horizontal main-justified><strong> Válv. CO2 (Spunding): </strong><div style=display:inline-block><strong><span id=capstate-open class=capstate>Aberta</span><span id=capstate-close class=capstate>Fechada</span></strong></div></li><li layout horizontal main-justified><span class=descriptor>Condição:</span><div style=display:inline-block><span id=cs-sgcon class=capstate>gravity &lt;= <span id=capgravityset></span></span> <span id=cs-timecon class=capstate>after <span id=captimeset></span></span> <span id=cs-mancap class=capstate>Fechada Manual</span><span id=cs-manopen class=capstate>Aberta Manual</span></div></li></ul><ul class=data-pane id=pressure-info-pane><li layout horizontal main-justified><span class=descriptor>Pressure</span><span><span id=pressure-psi></span> psi</span></li></ul><ul class=data-pane><li class=heading><strong>Geral:</strong></li><li layout horizontal main-justified><span class=descriptor>Registro:</span><span id=recording></span></li><li layout horizontal main-justified><span class=descriptor>Qualidade do Sinal (Wi-Fi):</span><div id=rssi class=wifi-bars><div class="rssi-bar rssi-bar1"></div><div class="rssi-bar rssi-bar2"></div><div class="rssi-bar rssi-bar3"></div><div class="rssi-bar rssi-bar4"></div></div></li></ul></div><div main flex><div layout horizontal><div class=chart><div id=div_g class=chart-main></div><div id=div_p class="chart-p pressure-group"></div></div><ul flex class=chart-legend><li layout horizontal main-justified class="chart-legend-row time"><span class=beer-chart-legend-time>Data/Hora</span><span class=beer-chart-state>status</span></li><li layout horizontal main-justified class="chart-legend-row beer-temp"><input type=checkbox id=beer-temp name=set-name class=switch-input checked><label onclick=BChart.toggle(BeerTempLine) for=beer-temp class=switch-label>Temp. Cerveja</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row beer-set"><input type=checkbox id=beer-set name=set-name class=switch-input checked><label onclick=BChart.toggle(BeerSetLine) for=beer-set class=switch-label>SP Cerveja</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row fridge-temp"><input type=checkbox id=fridge-temp name=set-name class=switch-input checked><label onclick=BChart.toggle(FridgeTempLine) for=fridge-temp class=switch-label>Temp. Refrig.</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row fridge-set"><input type=checkbox id=fridge-set name=set-name class=switch-input checked><label onclick=BChart.toggle(FridgeSetLine) for=fridge-set class=switch-label>SP Refrig.</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row room-temp"><input type=checkbox id=room-temp name=set-name class=switch-input checked><label onclick=BChart.toggle(RoomTempLine) for=room-temp class=switch-label>Temp. Amb.</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row aux-temp"><input type=checkbox id=aux-temp name=set-name class=switch-input checked><label onclick=BChart.toggle(AuxTempLine) for=aux-temp class=switch-label>Temp. Aux.</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row gravity"><input type=checkbox id=gravity name=set-name class=switch-input checked><label onclick=BChart.toggle(GravityLine) for=gravity class=switch-label>Densidade<span class=platounit>&deg;P</span></label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row filtersg"><input type=checkbox id=filtersg name=set-name class=switch-input checked><label onclick=BChart.toggle(FilteredSgLine) for=filtersg class=switch-label>SG Ajustada<span class=platounit>&deg;P</span></label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row pressure pressure-group"><input type=checkbox id=pressure name=set-name class=switch-input checked><label onclick=BChart.toggle(PressureLine,1) for=pressure class=switch-label>Pressure</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row pressure-set pressure-group"><input type=checkbox id=pressure-set name=set-name class=switch-input checked><label onclick=BChart.toggle(PressureSetLine,1) for=pressure-set class=switch-label>Pressure Set</label><div class=legend-value>--</div></li><li layout horizontal main-justified class="chart-legend-row carbonation pressure-group"><input type=checkbox id=carbonation name=set-name class=switch-input checked><label onclick=BChart.toggle(CarbonationLine,1) for=carbonation class=switch-label>CO2 Vol.</label><div class=legend-value>--</div></li><li layout horizontal main-justified class=chart-legend-row id=formula-btn onclick=openpolynomialpane()>f</li></ul></div></div></div><footer layout horizontal main-justified cross-center class=footer><span>BrewPiLess by <a href=https://github.com/vitotai/ >vitotai</a></span> <span><a href=https://github.com/vitotai/BrewPiLess/ >project on GitHub</a></span></footer><div class=error><div class=errormsg id=error_waitbpl> Aguardando atualização do script... </div><div class=errormsg id=error_connect> Falha de conexão com o servidor. </div><div class=errormsg id=error_noupdate> Controlador não atualiza dados. </div></div><div id=dlg_loading class=modal><div class=modal-content><p> Comunicando-se com o Brewpiless </p></div></div><div id=dlg_addgravity class=modal><div class=modal-content><span class="message sg"> Adicionar dados da densidade: </span><span class="message og"> Defina Densidade Original (OG): </span><p> Entre com o valor da densidade. </p><ul style=list-style-type:none><li><input class=sginput type=text size=6 onchange=inputsg_change()><span class=platounit>&deg;P</span> @ <input class=tempinput type=text size=6 value=20 onchange=inputsg_change()><sapn class=temp-unit>&deg;C</sapn></li><li>~ <span id=sginput-hmc></span> @ <span id=sginput-hm-cal-temp></span><sapn class=temp-unit>&deg;C</sapn></li><li>~ <span id=sginput-sg-ispindel></span><span class=platounit>&deg;P</span> @ <span id=sginput-ispindel-temp></span><sapn class=temp-unit>&deg;C</sapn></li></ul><div class=dialog-buttons><button class="btn btn--rise" onclick=dismissgravity()>Cancelar</button> <button class="btn btn--rise" onclick=inputgravity()>Confirmar</button></div></div></div><div id=polynomialpane class=modal><div class=modal-content><div id=xclose onclick=closepolynomialpane()>X</div><table><tr><td><table id=pointlist><thead><tr><th> Inclinação </th><th> SG<span class=platounit>&deg;P</span></th><th> Calculado </th><th> Erro </th><th> Ignorado </th></tr></thead><tobdy><tr class=pl_calpoint><td class=pl_tilt></td><td class=pl_sg></td><td class=pl_value></td><td class=pl_error></td><td><input class=pl_ignored_cb type=checkbox></td></tr></tobdy></table><div style=float:right><button class="btn btn--rise" onclick=applyIgnoreMask()>Aplicar</button></div></td><td><div id=graph></div><span id=polynormial></span></td></tr></table></div></div></body></html>